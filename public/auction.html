<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aucelot - Auction</title>
    
    <link rel="stylesheet" href="navigation.css">
    <link rel="stylesheet" href="footer.css">
    <link rel="stylesheet" href="auction.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <nav class="navbar">
        <div class="logo-container">
            <a href="#">
                <img src="./images/logo.png" alt="Aucelot Logo" class="logo-img">
            </a>
        </div>
        <div class="nav-right">
            <ul class="nav-links">
                <li><a href="./home.html">Home</a></li>
                <li><a href="./auction.html" class="active-link">Auction</a></li>
                <li><a href="./appraisal.html">Appraisal</a></li>
                <li><a href="./contact-us.html">Contact Us</a></li>
            </ul>
            <div class="nav-buttons">
                <a href="./log-in.html" class="btn btn-logout">Logout</a>
                <a href="./account.html" class="btn btn-account">Account</a>
            </div>
        </div>
    </nav>

    <header class="auction-hero">
        <div class="container">
            <h1>Auction</h1>
        </div>
    </header>

    <main class="container">
        
        <div class="auction-tabs-wrapper">
            <ul class="auction-tabs">
                <li class="tab-item active" onclick="filterAuction('all', this)">All Auction</li>
                <li class="tab-item" onclick="filterAuction('upcoming', this)">Upcoming Auction</li>
                <li class="tab-item" onclick="filterAuction('current', this)">Current Auction</li>
            </ul>
            <div class="tab-line"></div>
        </div>

        <div class="auction-controls">
            <div class="search-box">
                <input type="text" placeholder="Hinted search text" id="searchInput">
                <i class="fas fa-search search-icon"></i>
            </div>

            <div class="sort-box">
                <label>Sort auctions by</label>
                <select class="sort-dropdown" id="sortSelect" onchange="handleSortAndFilter()">
                    <option value="default">Default Sorting</option>
                    <option value="az">Name (A-Z)</option>
                    <option value="za">Name (Z-A)</option>
                </select>
            </div>
        </div>

        <div class="auction-grid" id="auctionGrid">
            </div>

        <div class="pagination">
            </div>

    </main>

    <footer>
        <div class="container footer-content">
            <div class="footer-left">
                <h2 class="footer-logo">Aucelot</h2>
                <p class="address">Khu phố 6, P.Linh Trung, Q.Thủ Đức, Tp.Hồ Chí Minh</p>
                <p class="copyright">© 2025 AUCELOT. All rights reserved</p>
            </div>
            <div class="footer-right">
                <h3>subscribe to our newsletter</h3>
                <form class="newsletter-form">
                    <input type="email" placeholder="enter your email address">
                    <button type="submit">Send</button>
                </form>
                <div class="footer-links">
                    <a href="#">Terms & Conditions</a>
                    <a href="#">Privacy Policy</a>
                </div>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script src="products.js"></script>

    <script>
        // 1. CẤU HÌNH PHÂN TRANG
        const ITEMS_PER_PAGE = 8;
        let currentPage = 1;

        // CÁC BIẾN TRẠNG THÁI
        let currentTab = 'all';
        const searchInput = document.getElementById('searchInput');
        const sortSelect = document.getElementById('sortSelect');
        const gridContainer = document.getElementById('auctionGrid');
        const paginationContainer = document.querySelector('.pagination');

        // 2. HÀM HELPER: Format ngày tháng cho thẻ sản phẩm
        function getStatusInfo(product) {
            let color = 'green';
            let labelText = '';
            
            const formatD = (dateString) => {
                const d = new Date(dateString);
                return d.toLocaleString('en-GB').replace(',', '');
            };

            if (product.type === 'current') {
                // Đang diễn ra => Hiển thị khi nào KẾT THÚC
                color = 'green';
                labelText = `auction ends in: ${formatD(product.endTime)} GMT+8`;
            } else if (product.type === 'upcoming') {
                // Sắp diễn ra => Hiển thị khi nào BẮT ĐẦU
                color = 'orange';
                labelText = `auction start in: ${formatD(product.startTime)} GMT+8`;
            } else {
                // Đã kết thúc
                color = 'red';
                labelText = 'This auction has ended';
            }
            
            return { color, labelText };
        }

        // 3. HÀM RENDER SẢN PHẨM
        function renderProducts(productsToRender) {
            gridContainer.innerHTML = ''; 

            if (productsToRender.length === 0) {
                gridContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No products found.</p>';
                return;
            }

            productsToRender.forEach(product => {
                // Xử lý hiển thị giá và nhãn giá
                let displayPrice = product.price !== "-" ? `$${product.price}` : "-";
                let priceLabel = product.type === 'ended' ? 'hammer price:' : 'current bid:';

                // Lấy thông tin trạng thái
                const { color, labelText } = getStatusInfo(product);

                const cardHTML = `
                    <div class="product-card type-${product.type}">
                        <div class="card-img">
                            <a href="./product-detail.html?id=${product.id}">
                                <img src="${product.img}" alt="${product.title}" loading="lazy">
                            </a>
                        </div>
                        <div class="card-content">
                            <h3 class="product-title">${product.title}</h3>
                            <p class="product-author">by ${product.author}</p>
                            
                            <div class="price-row">
                                <span class="price-label">${priceLabel}</span>
                                <span class="price-value">${displayPrice}</span>
                            </div>

                            <div class="status-row">
                                <span class="status-dot dot-${color}"></span>
                                <span class="status-text">${labelText}</span>
                            </div>

                            <a href="./product-detail.html?id=${product.id}" class="btn-card">Bid now</a>
                        </div>
                    </div>
                `;
                gridContainer.innerHTML += cardHTML;
            });
        }

        // 4. HÀM VẼ THANH PHÂN TRANG (1, 2, 3...)
        function renderPagination(totalItems) {
            paginationContainer.innerHTML = '';
            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);

            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const activeClass = (i === currentPage) ? 'active' : '';
                paginationContainer.innerHTML += `
                    <a href="javascript:void(0)" class="page-link ${activeClass}" onclick="changePage(${i})">${i}</a>
                `;
            }

            if (currentPage < totalPages) {
                paginationContainer.innerHTML += `
                    <a href="javascript:void(0)" class="page-link" onclick="changePage(${currentPage + 1})"><i class="fas fa-arrow-right"></i></a>
                `;
            }
        }

        // 5. HÀM CHUYỂN TRANG
        function changePage(page) {
            currentPage = page;
            handleSortAndFilter();
            document.querySelector('.auction-controls').scrollIntoView({ behavior: 'smooth' });
        }

        // 6. HÀM XỬ LÝ LỌC & SẮP XẾP & CẮT TRANG
        function handleSortAndFilter() {
            // Sử dụng mảng 'products' từ file products.js
            const searchText = searchInput.value.toLowerCase();
            const sortValue = sortSelect.value;

            //FILTER
            let filteredProducts = products.filter(product => {
                const matchTab = (currentTab === 'all') || (product.type === currentTab);
                const matchSearch = product.title.toLowerCase().includes(searchText) || 
                                    product.author.toLowerCase().includes(searchText);
                return matchTab && matchSearch;
            });

            //SORT
            filteredProducts.sort((a, b) => {
                if (sortValue === 'az') return a.title.localeCompare(b.title);
                if (sortValue === 'za') return b.title.localeCompare(a.title);
                return 0;
            });

            //PHÂN TRANG
            const totalItems = filteredProducts.length;
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            
            // Cắt mảng sản phẩm theo trang hiện tại
            const paginatedProducts = filteredProducts.slice(startIndex, endIndex);

            //HIỂN THỊ
            renderProducts(paginatedProducts);
            renderPagination(totalItems);
        }

        // 7. SỰ KIỆN CLICK TAB
        function filterAuction(type, element) {
            document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');
            currentTab = type;
            currentPage = 1; 
            handleSortAndFilter();
        }

        // 8. SỰ KIỆN TÌM KIẾM & SORT (Reset về trang 1)
        searchInput.addEventListener('input', () => {
            currentPage = 1;
            handleSortAndFilter();
        });
        
        sortSelect.addEventListener('change', () => {
            currentPage = 1;
            handleSortAndFilter();
        });

        // KHI LOAD TRANG
        if(typeof products !== 'undefined') {
            handleSortAndFilter();
        } else {
            gridContainer.innerHTML = '<p>Error: Could not load products.js</p>';
        }

    </script>
</body>
</html>